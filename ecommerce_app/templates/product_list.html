{% load static %}
{% load custom_filters %}


<div class="flex flex-col items-center gap-4 w-full max-w-4xl">
    {% for product in products %}
        <div class="flex w-full p-4 rounded-lg shadow-sm {% if product.id in cart_products %}shadow-green-300 border-1 border-green-300{% endif %}">
            <a href="{% url 'detail' product.id %}" aria-label="{{ product.name }}" class="flex justify-center items-center">
                <img src="{{ product.image.url }}" alt="{{ product.name }}" class="size-32 object-cover">
            </a>
            <div class="border-1 border-gray-300 mx-4"></div>
            <div class="flex flex-col justify-around gap-2 w-full">
                <div class="flex items-center {% if product.is_trend or product.is_top_of_category %}justify-between{% else%}justify-end{% endif %}">
                    {% include 'manage_tags.html' %}
                    
                    {% if is_cart %}
                        <a href="{% url 'remove_from_cart' product.id %}" class="p-1 save-scroll" aria-label="Remove from cart">
                    {% else %}
                        <a href="{% url 'manage_favorites' product.id %}" class="p-1 save-scroll" aria-label="Remove from favorites">
                    {% endif %}
                            <i class="fa-solid fa-xmark text-2xl text-red-500"></i>
                        </a>
                </div>
                <div class="flex items-center gap-2">
                    <i class="fa-solid fa-circle text-xs text-[#76b9f0]"></i>
                    <p>{{ product.category }}</p>
                </div>
                <a href="{% url 'detail' product.id %}" aria-label="{{ product.name }}">
                    <p class="text-xl font-semibold leading-tight">{{ product.name }}</p>
                </a>
                <div class="flex items-center justify-between gap-3">
                    <p class="text-xl">€ {% if is_cart %}{{ subtotal_dict|dict_key:product.id|floatformat:0 }}{% else %}{{ product.price|floatformat:0 }}{% endif %}</p>

                    {% include 'manage_cart_quantity.html' %}
                </div>
            </div>
        </div>
    {% endfor %}
    {% if is_cart %}
        <div class="flex w-full max-w-5xl rounded-lg shadow-sm shadow-green-300 border-1 border-green-300">
            <p class="text-xl font-semibold text-center w-full p-2">
                TOTAL | € {{ total|floatformat:0 }}
            </p>
        </div>
    {% endif %}
    <div class="w-full max-w-5xl shadow-sm rounded-lg">
        <div class="flex w-full rounded-lg bg-green-300">
            <a href="{% url is_cart|yesno:'checkout,add_all_favorites_to_cart' %}" aria-label="{{ is_cart|yesno:'Checkout button,Add all favorites to cart button' }}" class="text-xl font-semibold text-center w-full p-2 save-scroll">
                {{ is_cart|yesno:'Proceed to checkout,Add all to cart' }}
            </a>
        </div>
    </div>
</div>
